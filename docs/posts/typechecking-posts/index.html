<!doctype html>
<html lang="en" dir="auto">
    <head>
          <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Typechecking code in a Hakyll blog</title>


<meta name="keywords" content="programming, AI, haskell, health">



<meta name="description" content="Easy setup for hacking on Literate Haskell blog posts">





<link rel="canonical" href="https:&#x2F;&#x2F;blog.greghale.io&#x2F;posts&#x2F;typechecking-posts&#x2F;">


<link rel="stylesheet" href="https://blog.greghale.io/css/includes/scroll-bar.css">
<link rel="stylesheet" href="https://blog.greghale.io/css/styles.css">
<link rel="stylesheet" href="https://blog.greghale.io/css/override.css">







<link rel="alternate" type="application/rss+xml" title="RSS" href="https://blog.greghale.io/rss.xml">



<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }
    </style>
    
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
    
</noscript>






 
<link rel="stylesheet" href="https://blog.greghale.io/css/custom.css" />
 
    </head>
    <body
        class=""
        id="top"
    >
         
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }
</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https:&#x2F;&#x2F;blog.greghale.io" accesskey="h" title="Greg Hale&#x27;s Blog (Alt + H)">
                Greg Hale&#x27;s Blog
            </a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
                <ul class="lang-switch">
                    <li></li>
                </ul>
            </div>
        </div>
        
        <ul id="menu">
            
            
            
            <li>
                <a href="https:&#x2F;&#x2F;blog.greghale.io&#x2F;posts" title="Posts" >
                    <span>Posts</span>
                    
                </a>
            </li>
            
            
            
            <li>
                <a href="https:&#x2F;&#x2F;blog.greghale.io&#x2F;tags" title="Tags" >
                    <span>Tags</span>
                    
                </a>
            </li>
            
            
            
            <li>
                <a href="https:&#x2F;&#x2F;blog.greghale.io&#x2F;rss.xml" title="RSS" >
                    <span>RSS</span>
                    
                </a>
            </li>
            
        </ul>
        
    </nav>
</header>
 
        <main class="main">
            
<article class="post-single">
    <header class="post-header">
        <div class="breadcrumbs">
            <a href="https:&#x2F;&#x2F;blog.greghale.io">Home</a>&nbsp;»&nbsp;
            <a href="https://blog.greghale.io/posts/">Posts</a
            >&nbsp;»&nbsp;
            <a href="https:&#x2F;&#x2F;blog.greghale.io&#x2F;posts&#x2F;typechecking-posts&#x2F;">Typechecking code in a Hakyll blog</a>
        </div>
        <h1 class="post-title">Typechecking code in a Hakyll blog</h1>
        
        <div class="post-description">Easy setup for hacking on Literate Haskell blog posts</div>
        
        <div class="post-meta">












<span title="2019-10-20 00:00:00 +0000">October 20, 2019</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;
</div>
    </header>
    
    <div class="post-content"><h1 id="typechecking-code-in-a-hakyll-blog">Typechecking code in a Hakyll blog</h1>
<p>After years of programming in Haskell, my natural ability to
scrutinize my code for type errors (and even more mundane things,
like parse errors and spelling errors) has atrophied. Usually
my friends <code>ghc</code> and <code>ghcid</code> take care of this for me so I can
think about other things.</p>
<p>Recovering this workflow when writing <em>blog posts</em> took a little
time.</p>
<h2 id="literate-haskell">Literate Haskell</h2>
<p><code>Hakyll</code> handles Literate Haskell files already - you don't have
to do any work. Just create a file in <code>posts/</code> with the <code>.lhs</code>
file extension.</p>
<p>The format is described well in the
<a href="https://wiki.haskell.org/Literate_programming">Haskell Wiki</a>.
The only features I've used so far are</p>
<h3 id="code-blocks">Code blocks</h3>
<p>Most of my code blocks are long, so I prefer the latex-like
command over bird-tracks</p>
<pre data-lang="latex" style="background-color:#2b303b;color:#c0c5ce;" class="language-latex "><code class="language-latex" data-lang="latex"><span style="color:#b48ead;">\begin</span><span>{code}
</span><span>example = do
</span><span>  x &lt;- getTheX
</span><span>  useX x
</span><span style="color:#b48ead;">\end</span><span>{code}
</span></code></pre>
<h3 id="hidden-imports">Hidden imports</h3>
<p>Of course we need to import some modules if <code>ghc</code> is to
typecheck our <code>.lhs</code> file. Since the imports are often not
important to the explanation in the blog, I hide them.</p>
<p>Imaginary functions that I will later use in the blog post
but which aren't important to the topic at hand can be defined
here, too.</p>
<pre data-lang="latex" style="background-color:#2b303b;color:#c0c5ce;" class="language-latex "><code class="language-latex" data-lang="latex"><span style="color:#96b5b4;">\long</span><span style="color:#b48ead;">\def</span><span style="color:#96b5b4;">\ignore</span><span>#1{}
</span><span>
</span><span style="color:#96b5b4;">\ignore</span><span>{
</span><span style="color:#b48ead;">\begin</span><span>{code}
</span><span>{-# LANGUAGE ScopedTypeVariables, OverloadedStrings, TypeApplications #-}
</span><span>import qualified Servant.Server as Servant
</span><span>import Servant.API ((:&lt;|&gt;), (:&gt;))
</span><span>import qualified Database.PostgreSQL.Simple as PG
</span><span>
</span><span>processInputs :: Inputs -&gt; IO Outputs
</span><span>processInputs = undefined
</span><span style="color:#b48ead;">\end</span><span>{code}
</span></code></pre>
<h2 id="nix-shell">nix-shell</h2>
<p>A separate <code>nix-shell</code> is available for every post, in <code>shells.nix</code>.
At the top of this file is a record that maps post names to the names
of <code>Haskell</code> packages that I need to have in scope. There's only one
entry at the time of writing, because I only have one Literate Haskell
blog post:</p>
<pre data-lang="nix" style="background-color:#2b303b;color:#c0c5ce;" class="language-nix "><code class="language-nix" data-lang="nix"><span style="color:#b48ead;">let
</span><span>  </span><span style="color:#d08770;">shellPkgs </span><span>=
</span><span>    { </span><span style="color:#d08770;">config-phases </span><span>= [&quot;</span><span style="color:#a3be8c;">generic-lens</span><span>&quot; &quot;</span><span style="color:#a3be8c;">lens</span><span>&quot; &quot;</span><span style="color:#a3be8c;">postgresql-simple</span><span>&quot; &quot;</span><span style="color:#a3be8c;">katip</span><span>&quot;]; };
</span></code></pre>
<p>Later in the file, these lists are turned into derivations, so that I
can say</p>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">nix-shell</span><span> ./shells.nix</span><span style="color:#bf616a;"> -A</span><span> config-phases \
</span><span style="color:#bf616a;">  --run </span><span>&#39;</span><span style="color:#a3be8c;">ghcid --command &quot;ghci posts/2019-10-17-config-phase.lhs&quot;</span><span>&#39;
</span></code></pre>
<p>and now <code>ghcid</code> is recompiling my post and showing me the type errors
every time the post is saved.</p>
</div>
    <footer class="post-footer">
        
        <ul class="post-tags">
            
            <li>
                <a href="https:&#x2F;&#x2F;blog.greghale.io/tags/haskell/"
                    >haskell</a
                >
            </li>
            
            <li>
                <a href="https:&#x2F;&#x2F;blog.greghale.io/tags/nix/"
                    >nix</a
                >
            </li>
            
        </ul>
          


<nav class="paginav">
    
    <a class="prev" href="https:&#x2F;&#x2F;blog.greghale.io&#x2F;posts&#x2F;config-phase&#x2F;">
        <span class="title">« Prev</span>
        <br>
        <span>Organizing configs by usage phase</span>
    </a>
    
    
    <a class="next" href="https:&#x2F;&#x2F;blog.greghale.io&#x2F;posts&#x2F;vertigo&#x2F;">
        <span class="title">Next »</span>
        <br>
        <span>Vertigo</span>
    </a>
    
</nav>

 
    </footer>
</article>

        </main>
         <footer class="footer">
    
    <span>&copy; 2025 <a href="https:&#x2F;&#x2F;blog.greghale.io"></a></span>
    
    <span>
        Powered by
        <a href="https://www.getzola.org/" rel="noopener noreferrer" target="_blank">Zola</a> &
        <a href="https://github.com/cydave/zola-theme-papermod" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>


<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>


<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>


<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>



<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>


<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerText = 'copy';
        function copyingDone() {
            copybutton.innerText = 'copied!';
            setTimeout(() => {
                copybutton.innerText = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                var content = codeblock.textContent;
                if(codeblock.firstChild.tagName == 'TABLE') {
                    content = Array(...codeblock.firstChild.getElementsByTagName('span')).map((span) => { return span.textContent; }).join('');
                }
                navigator.clipboard.writeText(content);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            // td containing LineNos
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            // table containing LineNos and code
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            // code blocks not having highlight as parent class
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>


 
    </body>
</html>
